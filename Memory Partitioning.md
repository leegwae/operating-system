# Memory Partitioning

오늘날의 멀티 프로그래밍에서 CPU는 여러 개의 프로세스를 번갈아가며 실행한다. 프로세스는 운영체제로부터 할당받은 메모리에 적재되어 실행되므로, 운영체제는 메모리를 적절한 크기로 분할(partitioning)하여 다수의 프로세스들에게 할당할 수 있어야 한다. 이때 메모리를 분할하는 방식에는 메모리를 고정 크기로 분할하는 방식(fixed-size partitioning)과 가변 크기로 분할하는 방식(variable size partitioning)이 있다.



## 메모리 단편화

메모리 단편화(memory fragmentation)란 메모리에 빈 공간이 충분함에도 사용할 수 없는 문제를 가리킨다. 단편화는 내부 단편화와 외부 단편화로 나눌 수 있다.

내부 단편화(internal fragmentation)란 프로세스에게 필요로 하는 것보다 더 많은 메모리가 할당되어 쓰지 않는 공간이 낭비되는 문제이다. 외부 단편화(external fragmentation)는 빈 공간의 총량은 충분하지만 사용 중인 공간 사이사이에 있어 프로세스에게 연속적인 메모리를 할당하고자 할 때 할당이 불가능한 문제이다.

### 외부 단편화 해결하기

빈 공간들을 합치면 외부 단편화를 해결할 수 있다. 첫번째, 프로세스가 종료되어 메모리를 반납할 때 이 메모리를 인접한 빈 공간과 병합(coalescing)한다. 두번째, 주기적으로 모든 빈 공간을 모아 합친다. 압축(compaction)이라고 한다. 모든 빈 공간이 하나로 합쳐진다는 점에서 병합보다 이상적이다. 그러나 최적의 압축 알고리즘을 찾기 힘들다. 또한 메모리를 동적으로 재배치(dynamic reloaction)하고 시스템의 활동을 정지시켜야해서 오버헤드가 상당히 크다.



## 고정 크기 분할

고정 크기 분할(fixed-size partitioning)은 정해진 크기로 쪼개어진 물리적 메모리를 프로세스에 할당하는 방식이다. 따라서 프로세스는 연속한 메모리에 적재되지 않을 수 있다. 프로세스가 연속한 메모리에 적재되지 않아도 되어 외부 단편화가 발생하지 않는다. 하지만 프로세스의 크기보다 큰 메모리를 할당한다면 쓰지 않는 공간이 생겨 내부 단편화가 발생한다.



## 가변 크기 분할

가변 크기 분할(variable size partitioning)은 프로세스의 크기만큼 연속적인 메모리를 할당하는 방식이다. 프로세스가 연속한 메모리에 적재되어야 하므로 외부 단편화가 발생할 수 있다. 하지만 프로세스는 필요한 만큼의 메모리만을 할당받으므로 내부 단편화가 발생하지 않는다.



## 연속 메모리 할당 방식

메모리 배치 알고리즘이라고도 한다. 프로세스에게 연속 메모리를 할당할 때, 최대한 내부 단편화가 생기지 않도록 빈 공간을 선택하는 알고리즘이다.

첫번째, 최초적합(first-fit) 알고리즘이다. 위에서부터 탐색하다가 필요한 것보다 큰 공간을 발견하면 들어간다. 빠르지만, 위에서부터 탐색하므로 사용되지 않는 아래 쪽의 메모리가 낭비되는 단점이 있다.

두번째, 최적적합(best-fit) 알고리즘이다. 전체 공간을 탐색하여 필요한 것보다 큰 공간 중 가장 작은 공간에 들어간다. 외부 단편화의 크기를 줄일 수 있지만, 느리고 작은 외부 단편화가 여러 개 생긴다는 단점이 있다.

세번째, 최악적합(worst-fit) 알고리즘이다. 전체 공간을 탐색하여 가장 큰 공간에 들어간다. 빈 공간의 크기가 작지 않아 다시 사용할 수도 있지만, 느리다는 단점이 있다.

네번째, 다음적합(next-fit) 알고리즘이다. 이전 검색 위치부터 탐색하여 첫번째로 발견한 적재 가능한 공간에 들어간다. 전체 공간을 골고루 사용하지만, 골고루 작은 외부 단편화가 생긴다는 단점이 있다. 